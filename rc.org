#+title: Emacs Configuration
#+author: sndb

* Intro

#+begin_src emacs-lisp
  ;; -*- lexical-binding: t -*-
#+end_src

* Packages

** MELPA

#+begin_src emacs-lisp
  (require 'package)
  (add-to-list 'package-archives
               '("melpa" . "https://melpa.org/packages/"))
#+end_src

** use-package

#+begin_src emacs-lisp
  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))

  (require 'use-package)
  (setq use-package-always-ensure t)
#+end_src

* General

** Basic

#+begin_src emacs-lisp
  (setq inhibit-startup-screen t)
  (setq use-short-answers t)
#+end_src

** Server

#+begin_src emacs-lisp
  (server-start)
#+end_src

** Keybindings

#+begin_src emacs-lisp
  (global-set-key (kbd "C-c w") 'delete-trailing-whitespace)
#+end_src

* Files

** Custom file

#+begin_src emacs-lisp
  (setq custom-file (locate-user-emacs-file "custom.el"))
  (load custom-file)
#+end_src

** Temporary files

#+begin_src emacs-lisp
  (setq create-lockfiles nil
        make-backup-files nil
        auto-save-default nil)
#+end_src

** Recently edited files

#+begin_src emacs-lisp
  (recentf-mode)
#+end_src

** Save place

#+begin_src emacs-lisp
  (setq save-place-limit 128)
  (save-place-mode)
#+end_src

** Auto revert

#+begin_src emacs-lisp
  (global-auto-revert-mode)
#+end_src

* Visuals

** Basics

#+begin_src emacs-lisp
  (add-hook 'prog-mode-hook 'display-line-numbers-mode)
  (add-hook 'prog-mode-hook 'hl-line-mode)

  (use-package visual-fill-column
    :init
    (add-hook 'visual-line-mode-hook 'visual-fill-column-mode))
#+end_src

** Scrolling

#+begin_src emacs-lisp
  (setq scroll-preserve-screen-position t
        scroll-conservatively 1)
#+end_src

** Modeline

#+begin_src emacs-lisp
  (setq display-time-day-and-date t)

  (display-time-mode)
  (line-number-mode)
  (column-number-mode)
  (size-indication-mode)
#+end_src

** Frame

#+begin_src emacs-lisp
  (setq frame-resize-pixelwise t)

  (menu-bar-mode 0)
  (scroll-bar-mode 0)
  (tool-bar-mode 0)
#+end_src

** Fonts

#+begin_src emacs-lisp
  (setq sndb-mono-font "Iosevka-12")
  (setq sndb-sans-font "Iosevka Aile-12")

  (set-face-attribute 'default nil :font sndb-mono-font)
  (set-face-attribute 'fixed-pitch nil :font sndb-mono-font)
  (set-face-attribute 'variable-pitch nil :font sndb-sans-font)
#+end_src

** Theme

#+begin_src emacs-lisp
  (defun sndb-load-theme ()
    "Loads a theme corresponding to the current time.
  Selects the light theme in the morning or afternoon, the dark
  theme in the evening or at night."
    (interactive)
    (if (<= 6 (decoded-time-hour (decode-time)) 18)
        (modus-themes-load-operandi)
      (modus-themes-load-vivendi)))

  (use-package modus-themes
    :init
    (setq modus-themes-bold-constructs t
          modus-themes-italic-constructs t
          modus-themes-syntax '(yellow-comments)
          modus-themes-mixed-fonts t
          modus-themes-prompts '(background bold)
          modus-themes-mode-line '(accented)
          modus-themes-paren-match '(bold)
          modus-themes-region '(bg-only no-extend)
          modus-themes-org-blocks 'tinted-background
          modus-themes-headings '((t . (overline background))))
    (modus-themes-load-themes)
    :config
    (sndb-load-theme)
    :bind ("<f5>" . modus-themes-toggle))
#+end_src

* Keyboard

#+begin_src emacs-lisp
  (setq sentence-end-double-space nil)
  (setq indent-tabs-mode nil)

  (use-package which-key
    :init
    (setq which-key-idle-delay 0.25)
    :config
    (which-key-mode))

  (defun sndb-scroll-third-height-up ()
    "Scrolls text up a third of the window height."
    (interactive)
    (scroll-up (/ (window-height) 3)))

  (defun sndb-scroll-third-height-down ()
    "Scrolls text down a third of the window height."
    (interactive)
    (scroll-down (/ (window-height) 3)))

  (global-set-key (kbd "C-S-n") 'sndb-scroll-third-height-up)
  (global-set-key (kbd "C-S-p") 'sndb-scroll-third-height-down)
#+end_src

* Org

#+begin_src emacs-lisp
  (global-set-key (kbd "C-c l") 'org-store-link)
  (global-set-key (kbd "C-c a") 'org-agenda)
  (global-set-key (kbd "C-c c") 'org-capture)

  (add-hook 'org-mode-hook 'visual-line-mode)

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((python . t)
     (shell . t)))

  (setq org-default-notes-file (concat org-directory "/notes.org"))
  (setq org-startup-indented t)
  (setq org-confirm-babel-evaluate nil)
  (setq org-capture-templates
        '(("t" "Task" entry (file+headline "" "Tasks")
           "* TODO %?\n%u\n%a\n%i"
           :empty-lines 1)
          ("j" "Journal" entry (file+olp+datetree "journal.org")
           "* %?"
           :empty-lines 1
           :jump-to-captured t)))
#+end_src

* Completion

#+begin_src emacs-lisp
  (setq history-length 32)
  (savehist-mode)

  (use-package vertico
    :init
    (vertico-mode))

  (use-package orderless
    :custom
    (orderless-matching-styles '(orderless-flex orderless-regexp))
    (completion-styles '(orderless basic))
    (completion-category-overrides '((file (styles basic partial-completion)))))

  (use-package marginalia
    :bind
    (:map minibuffer-local-map
          ("M-A" . marginalia-cycle))
    :init
    (marginalia-mode))

  (use-package embark
    :bind
    (("C-." . embark-act)
     ("M-." . embark-dwim)
     ("C-h B" . embark-bindings)))

  (use-package consult
    :bind
    (("C-c o k" . consult-kmacro)
     ("C-c o b" . consult-buffer)
     ("C-c o 4 b" . consult-buffer-other-window)
     ("C-c o 5 b" . consult-buffer-other-frame)
     ("C-c o y" . consult-yank-pop)
     ("C-c o e" . consult-compile-error)
     ("C-c o f" . consult-flymake)
     ("C-c o o" . consult-outline)
     ("C-c o i" . consult-imenu)
     ("C-c o I" . consult-imenu-multi)
     ("C-c o d" . consult-find)
     ("C-c o D" . consult-locate)
     ("C-c o r" . consult-ripgrep)
     ("C-c o l" . consult-line)
     ("C-c o L" . consult-line-multi)))

  (use-package embark-consult
    :after (embark consult)
    :demand t
    :hook
    (embark-collect-mode . consult-preview-at-point-mode))

  (use-package wgrep)

  (use-package corfu
    :init
    (global-corfu-mode))

  (defun corfu-enable-always-in-minibuffer ()
    (unless (bound-and-true-p vertico--input)
      (corfu-mode 1)))
  (add-hook 'minibuffer-setup-hook 'corfu-enable-always-in-minibuffer 1)
#+end_src

* Applications

** Terminal

#+begin_src emacs-lisp
  (use-package vterm)
#+end_src

** Readers

*** PDF

#+begin_src emacs-lisp
  (use-package pdf-tools
    :init
    (pdf-tools-install))
#+end_src

*** Epub

#+begin_src emacs-lisp
  (use-package nov
    :custom
    (nov-text-width 80)
    :init
    (add-to-list 'auto-mode-alist '("\\.epub\\'" . nov-mode)))
#+end_src
